<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="renderer" content="webkit">
    <title><{$bar.name}></title>
    <link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css"  media="all">
    
   
    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="__PUBLIC__/looK/css/bootstrap.min.css"  type="text/css">
  
  <!-- Custom CSS -->
    <link rel="stylesheet" href="__PUBLIC__/looK/css/style.css">
  
  <!-- Owl Carousel Assets -->
    <link href="__PUBLIC__/looK/owl-carousel/owl.carousel.css" rel="stylesheet">
    <link href="__PUBLIC__/looK/owl-carousel/owl.theme.css" rel="stylesheet">
  
  <!-- Custom Fonts -->
    <link rel="stylesheet" href="__PUBLIC__/looK/font-awesome-4.4.0/css/font-awesome.min.css"  type="text/css">

    <link rel="stylesheet" type="text/css" href="__PUBLIC__/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/style1.css">
  <!-- jQuery and Modernizr-->
  <script src="__PUBLIC__/looK/js/jquery-2.1.1.js"></script>
    <script type="text/javascript" src="__PUBLIC__/layui/layui.js"></script>
  
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="js/html5shiv.js"></script>
        <script src="js/respond.min.js"></script>
    <![endif]-->

</head>

<body>
<header>
  <!--Top-->
  <nav id="top">
    <div class="row" style="margin: 0">
        <div class="col-md-6">
            <a href="<{:U('Home/Index/index')}>"><strong><i class="fa fa-home"></i>首页</strong></a>
        </div>
        <div class="col-md-6">
            <ul class="list-inline top-link link">
                <if condition='$Think.session.home_user eq ""'>
                  <li style="margin-left: 340px;"><a href="<{:U('Login/index')}>">登录</a></li>
                  <li><a href="<{:U('Register/index')}>">注册</a></li>
                  <else />
                  <li style="margin-left: 410px;"><a href="<{:U('Logout/doLogout')}>">退出</a></li>
                </if>
            </ul>
        </div>
    </div>
    </nav>
  
</header> 
  
  <div class='nav-main container'>
    
      <ul>
        <li>
          <img style="width:100px;height:100px;" src="__UPLOAD__/img/tieba-thumb/<{$arr.bpic}>" alt="">
        </li>
        <li><b><{$arr.bname}></b></li>
        <li>
            <span class='actionbtn'>
                <if condition='($Think.session.home_user eq null) or ($user eq null)'>
                    <a href="javascript:;" class="btn btn-danger" style='margin-left:40px' onclick="start()"><span class='glyphicon glyphicon-heart'></span>关注</a>
                <else/>
                    <a href="javascript:;" class="btn btn-default" style='margin-left:40px' onclick="closebtn()"><span class='glyphicon glyphicon-ok' ></span>已关注 | 取消</a>
                </if>
            </span>
        </li>
        <li style="color:#b9b1c4">关注：<span style="color:#f9ab55;"><{$follow}></span></li>
        <li style="color:#b9b1c4">帖子：<span style="color:#f9ab55;"><{$post}></span></li>
      </ul>  
      <input type="hidden" id="bid" value="<{$arr.bid}>">
      <span style='float:right'><a href="<{:U('Bar/index')}>?id=<{$arr.bid}>"><<返回<{$arr.bname}></a></span>
  </div>
  <!-- Header -->
  
  <!-- /////////////////////////////////////////Content -->
       
  <div id="page-content" class="archive-page container">
    
    <div class="">
      <div class="row">

       <div id="main-content" class="col-md-8">
       <div style='height:60px;background: #f0f0f0;'>
       <div class='col-md-8'><h4 style='color:blue;font-weight: bold;font-size: 20px;line-height: 60px;'><{$arr.title}></h4></div>
        <div class='col-md-4' >
        <ul id='root'>
          <li>
            <span class='collbtn'>
              <if condition='($Think.session.home_user eq null) or ($coll eq null)'>
                  <a href="javascript:;" onclick="coll(<{$arr.id}>)">收藏</a>
              <else/>
                  <a href="javascript:;" onclick="delcoll(<{$arr.id}>)">已收藏</a>
              </if>
            </span>
            
          </li>
          <li><a href='#com'>回复</a></li>
          
        </ul>
        </div>
        </div>
        
        <hr class="line">
        <if condition='($arr.p eq 0) or ($arr.p eq 1)'>
          <div class="box">
        <else/>
          <div class="box" style='display: none;'>
        </if>
            <div class="col-md-3" style='background: #f0f0f0'>
              <span style='color:blue;font-size: 20px;'>楼主</span>
              <a href="<{:U('User/index')}>?id=<{$arr.uid}>"><img style="width:100px;height:100px;" src="__UPLOAD__/img/avatar-thumb/<{$arr.upic}>" alt=""></a>
              <p><b><a href="<{:U('User/index')}>?id=<{$arr.uid}>"><{$arr.uname}></a></b></p>
              <p><b><{$arr.exp|grade}></b></p>
            </div>
              <div class="col-md-9">
              <div>
              <p style="margin-top: 20px;"><{$arr.descr}></p></div>
              <div style="margin-top: 90px;margin-left: 220px;"><p><span><i class="fa fa-calendar"></i> <{$arr.ctime|date="Y-m-d H:i:s",###}></span>
              <a href='#com'>回复</a></div></p>
            </div>
            
            </div>
            <hr class="line">
            
            <foreach name='comment' item='v'>
            <div class="box">
              <div class="col-md-3" style='background: #f0f0f0'>
              <eq name="v.uid" value="$arr.uid"  >
                <span style='color:blue;font-size: 20px;'>楼主</span>
              </eq>
                <a href="<{:U('User/index')}>?id=<{$v.uid}>"><img style="width:100px;height:100px;" src="__UPLOAD__/img/avatar-thumb/<{$v.upic}>" alt=""></a>
                <p><b><a href="<{:U('User/index')}>?id=<{$v.uid}>"><{$v.name}></a></b></p>
                <p><b><{$v.exp|grade}></b></p>
              </div>
              <div class="col-md-9">
              <div>
              <p style="margin-top: 20px;"><{$v.content}></p></div>
              <div style="margin-top: 90px;margin-left: 200px;">
                <span><i class="fa fa-calendar"></i> <{$v.ctime|date="Y-m-d H:i:s",###}></span>
                <a href="javascript:;" class='reply' style='width:80px;height:30px;line-height:30px;text-align:center;display:block;float:right;margin-top:-8px;'>回复</a>
              </div>
              <div style='background: #abcdef;display: none;' class='replybox'>
                <input type="hidden" name="cmtid" value='<{$v.id}>' id='cmtid'>
                <volist name='v.r' id='vs'>
                  <div class='col-md-12' style='margin-top:5px;'>
                    <div class='col-md-2'><img width=40 src="__UPLOAD__/img/avatar-thumb/<{$vs.picname}>"></div>
                    <div class='col-md-8'><span id='name'><{$vs.name}></span><span><{$vs.content}></span></div>
                    <div class='col-md-2'><a href="javascript:;" class='replyname'>回复</a></div>
                  </div>
                </volist>
                <input type="text" id='content' name="content" style='width:400px;margin-left: 10px;height:30px;margin-top: 20px;' placeholder="" >
                <a href="javascript:;" class='btn btn-primary replybtn' style='margin-left: 350px'>发送</a>
              </div>
              
            </div>
            </div>
            <hr class="line">
            </foreach>
        
        <!-- <div> -->
            <{$page}>
        <!-- </div> -->
                
        <!-- 发表评论开始 -->
        <div style='background:#EFEFEF;margin-top: 50px' id='com'>
            <h5 style='color: blue;font-size: 16px;margin-top: 10px'><span class='glyphicon glyphicon-pencil'>发表评论</span></h5>
            <form action="<{:U('Comment/doAdd')}>" method="post">
                  <input type="hidden" name="postid" value="<{$arr.id}>"> 
                  <input type="hidden" name="uid" value="5"> 
                  
                  
            <script id="container" name="content" type="text/plain" style="width:650px;height:220px">
                </script>
                <!-- 配置文件 -->
                <script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.config.js"></script>
                <!-- 编辑器源码文件 -->
                <script type="text/javascript" src="__PUBLIC__/ueditor/ueditor.all.js"></script>
                <!-- 实例化编辑器 -->
                <script type="text/javascript">
                    var ue = UE.getEditor('container',{
                        indentValue:'2em'
                        ,initialFrameWidth:650  //初始化编辑器宽度,默认1000
                        ,initialFrameHeight:220  //初始化编辑器高度,默认320
                        ,zindex:650
                        , toolbars: [[
                        'fullscreen', 'undo', 'redo', '|',
                        'bold', 'italic', 'underline', 'fontborder', 'rowspacingbottom', 'lineheight', '|', 'fontfamily', 'fontsize', '|',
                        'directionalityltr', 'directionalityrtl', 'indent', '|',
                        'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 
                        'simpleupload', 'insertimage', 'emotion', 'scrawl', 'insertvideo', 'music', 'attachment', 'map', 'gmap', 'insertframe', '|',
                        'horizontal', 'date', 'time', 'snapscreen'
                        ]]
                        //是否启用元素路径，默认是显示
                        ,elementPathEnabled :false
                        ,autoHeightEnabled: false
                    });
                </script>
                <input type="submit" name="" value="提交" class='btn btn-primary'>
            </form>
                    
        </div> 
                    
        <!-- 发表评论结束-->
        </div>
        <div id="sidebar" class="col-md-4">
          <!---- Start Widget ---->
          <!-- <div class="widget wid-follow">
            <div>
              <div class="heading"><h4>获得经验</h4></div>
              <div class="content" style='margin-top: 10px'>
                  <a href="javascript:;" class="btn btn-danger" style='margin-left: 40px'><span class='glyphicon glyphicon-heart'></span>关注</a>
                  <button class="btn btn-primary " style='margin-left: 50px'><span class='glyphicon glyphicon-pencil'></span>签到</button>
              </div>
            </div>

          </div> -->

            <if condition='$supfans eq ""'><div class="widget wid-post"  style='display:none'>
            <else/><div class="widget wid-post">
            </if>
                    
          <!---- Start Widget ---->
          <!-- <div class="widget wid-post"  style='display:none'> -->
            <div class="heading"><h4>本吧名人</h4></div>
            <div class="content">
              <foreach name='supfans' item='va' key='k'> 
              <div class="post wrap-vid">
                <div class="zoom-container">
                  <img width=100 src="__UPLOAD__/img/avatar-thumb/<{$va.picname}>" />
                </div>
                <div class="wrapper">
                  <h5 class="vid-name"><{$va.name}></h5>
                  <div class="info">
                    <h6>本吧名气 <a href="#"><{$k+1}></a></h6>
                    <span><i class="fa fa-calendar"></i>用户等级：<{$va.exp|grade}></span> 
                    <!-- <span><i class="fa fa-heart"></i>48</span> -->
                  </div>
                </div>
              </div>
              </foreach>
            </div>
          </div>
                    
          <!---- Start Widget ---->
          <if condition='$Think.session.home_user.id eq "" '>
          <else/>
            <div class="widget ">
              <div class="heading"><h4>个人信息</h4></div>
              <div class="content">
                <div class="wrap-vid">
                  <div class="zoom-container">
                    <a href="<{:U('User/index')}>"><img src="__UPLOAD__/img/avatar-thumb/<{$Think.session.home_user.picname}>" />                
                  </div>
                  <h3 style='color:blue;font-size: 20px'><a href="<{:U('User/index')}>"><{$Think.session.home_user.name}></a></h3>
                  <h3 class="vid-name" style='color:blue;font-size: 20px'>我的等级：<{$Think.session.home_user.exp|grade}></h3>
                  <h3 class="vid-name">注册时间<{$Think.session.home_user.regtime|date="Y-m-d H:i:s",###}></h3>
                </div>
                
              </div>
            </div>
            </if>

              <!-- <div class="widget ">
                  <div class="heading"><h4>天气查询</h4></div>
                  
              </div> -->
        </div>

      </div>
    </div>
  </div>

  <!-- <hr> -->

  <footer>
    <div class="footer" alog-alias="footer">
        <div class="wrap-footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-8 col-footer footer-3">
                    <div class="footer-heading"><h4>友情链接</h4></div>
                    <volist name='data' id='vo'>
                        <div class="content">
                            <ul id='footer'>
                            <volist name='vo' id='v'>
                                <li><a href="<{$v.url}>"><{$v.name}></a></li>
                            </volist>
                            </ul>
                        </div>
                    </volist>
                    </div>
                </div>
            </div>
            <p alog-group="copy">©2016 Baidu<a href="http://www.baidu.com/duty/">使用百度前必读</a><a href="http://tb1.bdstatic.com/tb/eula.html">贴吧协议</a>信息网络传播视听节目许可证 0110516<a href="http://net.china.cn/chinese/index.htm" target="_blank"></a><img src="//tb2.bdstatic.com/tb/static-common/img/net_0d27e51.png" width="20"></p>
        </div>
    </div>
    
    
  </footer>
  <!-- Footer -->
  
  <!-- JS -->
  <script src="__PUBLIC__/js/jquery-2.1.4.min.js"></script>
    <script src="__PUBLIC__/js/bootstrap.js"></script>
  <script src="__PUBLIC__/looK/owl-carousel/owl.carousel.js"></script>
    <script type="text/javascript" src="__PUBLIC__/H-ui/lib/layer/2.1/layer.js"></script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","qzone","tsina","weixin","renren","tqq","tqf","douban","thx","fbook","twi","linkedin"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"1","bdPos":"right","bdTop":"100"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
    <script>
    $(document).ready(function() {
      $("#owl-demo").owlCarousel({
        autoPlay: 3000,
        items : 5,
        itemsDesktop : [1199,4],
        itemsDesktopSmall : [979,4]
         
        });
                            
    });
    $(function(){
      $(document).on('click','.reply',function(){
        if ($(this).text()=='回复') {
          $(this).text('收起回复');
          $(this).css('background','#abcdef');
          $(this).parent().next().css('display','block');
        } else if ($(this).text()=='收起回复') {
          $(this).text('回复');
          $(this).css('background','#fff');
          $(this).parent().next().css('display','none');
        }
      });

      $(document).on('click','.replybtn',function(){
        // 判断 用户是否登录
        if('<{:session("home_user")["id"]}>'=='') {
            layer.open({
              title: '回复'
              ,content: '请先登录'
            });
            return false;
        }
        var placeholder = $(this).prev().attr('placeholder');
        // console.log(placeholder);

        var content = $(this).prev().val();
        // console.log(content);
        if (content=='') {
          layer.open({
              title: '取消关注'
              ,content: '请输入回复内容'
            });
          
          return false;
        }
        content = placeholder+':'+content;
        // console.log(content);
         
        var uid = <{:session("home_user")["id"]}>;
        var name = '<{:session("home_user")["name"]}>';
        var picname = '<{:session("home_user")["picname"]}>';
        var cmtid =$(this).parent().children('#cmtid').val(); 
        var obj = $(this);

        $.ajax({
            type: "POST",
            url:"<{:U('Reply/doAdd')}>" ,
            data: "content="+content+"&uid="+uid+"&cmtid="+cmtid, 
            success: function(data){
                if (data === true) {
                  // console.log($(obj));
                  obj.prev().before("<div class='col-md-12' style='margin-top:5px;'><div class='col-md-2'><img width=40 src='__UPLOAD__/img/avatar-thumb/"+picname+"'></div><div class='col-md-8'>"+name+"<span>"+content+"</span></div><div class='col-md-2'><a href='javascript:;' class='replyname'>回复</a></div></div>");
                  obj.prev().val('');
                  obj.prev().attr('placeholder','');
                }
            }  
        });
      });

      $(document).on('click','.replyname',function(){
          var holder = ' 回复 '+$(this).parent().prev().children('#name').html();
          // console.log(placeholder);
          
          $(this).parent().parent().parent().find('#content').attr('placeholder',holder);
      });

    });

//  收藏帖子
    function coll(id) {
      if ('<{:session("home_user")["id"]}>' == "") {
            layer.open({
              title: '收藏'
              ,content: '请先登录'
            });
            return false;
        }
        var uid = <{:session("home_user")["id"]}>;
        $.ajax({
            type:"POST",
            url: "<{:U('Collection/coll')}>",
            data: 'selfid='+uid+'&postid='+id,
            success: function(data){
                if (data) {
                    $('.collbtn').html('<a href="javascript:;" onclick="delcoll('+id+')">已收藏</a>');
                } else {
                    alert(data);
                }
            }
        });
    }


    //  取消收藏帖子
    function delcoll(id) {
      if ('<{:session("home_user")["id"]}>' == "") {
            layer.open({
              title: '取消收藏'
              ,content: '请先登录'
            });
            return false;
        }
        var uid = <{:session("home_user")["id"]}>;
        $.ajax({
            type:"POST",
            url: "<{:U('Collection/delcoll')}>",
            data: 'selfid='+uid+'&postid='+id,
            success: function(data){
                if (data) {
                    $('.collbtn').html('<a href="javascript:;" onclick="coll('+id+')">收藏</a>');
                } else {
                    alert(data);
                }
            }
        });
    }

    // $('.reply').blur(function(){
    //     if ($(this).val().length == '') {
    //         layer.open({
    //           title: '回复'
    //           ,content: '请输入回复'
    //         });
    //     } else if ($(this).val().length > 30) {
    //         layer.open({
    //           title: '回复'
    //           ,content: '回复长度不正确'
    //         });
    //     }
    // });

    // 取消关注贴吧
    function closebtn() {
        if ('<{:session("home_user")["id"]}>' == "") {
            layer.open({
              title: '取消关注'
              ,content: '请先登录'
            });
            return false;
        }
        var bid = $('#bid').val();
        var uid = <{:session("home_user")["id"]}>;
        $.ajax({
            type:"POST",
            url: "<{:U('Follow/closebtn')}>",
            data: 'uid='+uid+'&bid='+bid,
            success: function(data){
                if (data) {
                    $('.actionbtn').html('<a href="javascript:;" class="btn btn-danger" onclick="start()" style=\'margin-left:40px\'><span class=\'glyphicon glyphicon-heart\'></span>关注</a>');
                } else {
                    layer.open({
                      title: '取消关注'
                      ,content: '取消关注失败'
                    });
                }
            }
        });
    }

    // 关注贴吧
    function start() {
        
        if ('<{:session("home_user")["id"]}>' == "") {
            layer.open({
              title: '关注'
              ,content: '请先登录'
            });
            return false;
        }
        var uid = <{:session("home_user")["id"]}>;
        var bid = $('#bid').val();
        $.ajax({
            type:"POST",
            url: "<{:U('Follow/startbtn')}>",
            data: 'uid='+uid+'&bid='+bid,
            success: function(data){
                if (data) {
                    $('.actionbtn').html('<a href="javascript:;" onclick="closebtn()" class="btn btn-default" style="margin-left:40px"><span class="glyphicon glyphicon-ok" ></span>已关注 | 取消</a>');
                } else {
                    layer.open({
                      title: '关注'
                      ,content: '关注失败'
                    });
                }
            }
        });
    }
    
    </script>
</body>
</html>
